<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å®¶æ—ä¿®ä»™å½• v0.36 - ç«‹ç»˜ç‰ˆ</title>
    <style>
        /* index.html <style> åŒºåŸŸæ–°å¢ */

/* å¤´åƒå®¹å™¨ï¼šç›¸å¯¹å®šä½ï¼Œç”¨æ¥åŒ…ä½æ‰€æœ‰çš„å±‚ */
.avatar-box {
    position: relative;
    display: inline-block;
    background-color: #f0f0f0; /* æš‚æ—¶çš„åº•è‰²ï¼Œå¦‚æœæ˜¯é€æ˜å›¾å¯ä»¥çœ‹åˆ°ç°è‰²èƒŒæ™¯ */
    border-radius: 8px;        /* åœ†è§’çœ‹èµ·æ¥èˆ’æœç‚¹ */
    overflow: hidden;          /* è¶…å‡ºåœ†è§’çš„éƒ¨åˆ†åˆ‡æ‰ */
    flex-shrink: 0;            /* é˜²æ­¢åœ¨flexå¸ƒå±€é‡Œè¢«æŒ¤æ‰ */
    vertical-align: middle;    /* æ–‡å­—å¯¹é½ */
    border: 1px solid #ddd;    /* æ·¡æ·¡çš„è¾¹æ¡† */
    margin-right: 8px;         /* ç»™å³è¾¹çš„æ–‡å­—ç•™ç‚¹ç¼éš™ */
}

/* æ¯ä¸€å±‚çš„å›¾ç‰‡ï¼šç»å¯¹å®šä½ï¼Œå åœ¨å®¹å™¨å·¦ä¸Šè§’ */
.avatar-layer {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    object-fit: cover;     /* é“ºæ»¡å®¹å™¨ */
    pointer-events: none;  /* è®©é¼ æ ‡ç‚¹å‡»èƒ½ç©¿é€å›¾ç‰‡ï¼Œç‚¹åˆ°ä¸‹é¢çš„æŒ‰é’® */
}
        /* === 1. å…¨å±€é…è‰²å‡çº§ === */
:root { 
    --main-color: #4a3b52;    /* ç»›ç´«ï¼šæ›´æ·±æ²‰çš„ä¸»è‰²ï¼Œä»£æ›¿åŸæ¥çš„äº®ç´« */
    --bg-color: #fdfbf7;      /* ç±³ç™½ï¼šå®£çº¸è´¨æ„ŸèƒŒæ™¯ */
    --panel-bg: #ffffff;      /* é¢æ¿èƒŒæ™¯ï¼šçº¯ç™½ */
    --text-color: #2c3e50;    /* å¢¨è‰²ï¼šæ­£æ–‡æ–‡å­— */
    --accent-color: #c0392b;  /* æœ±ç ‚ï¼šå¼ºè°ƒè‰²ï¼ˆç”¨äºæˆ˜æ–—/å±é™©ï¼‰ */
    --border-color: #e6e2d8;  /* è¾¹æ¡†è‰²ï¼šæ·¡é›…çš„ç±³ç°è‰² */
}

body { 
    font-family: "Microsoft YaHei", "Heiti SC", sans-serif; /* ä¼˜åŒ–å­—ä½“æ˜¾ç¤º */
    background-color: var(--bg-color);
    /* å¢åŠ ä¸€ä¸ªå¾®å¦™çš„çºµå‘æ¸å˜ï¼Œæ¨¡æ‹Ÿçº¸å¼ å…‰ç…§ */
    background-image: linear-gradient(to bottom, #fdfbf7 0%, #f4f1ea 100%); 
    color: var(--text-color); 
    padding: 20px; 
    display: flex; 
    gap: 20px; 
    height: 95vh; 
    overflow: hidden;
}
        /* æ¸¸æˆä¸»åŒºåŸŸ */
.game-area { 
    flex: 3; 
    display: flex; 
    flex-direction: column; 
    overflow-y: auto; 
    padding-right: 10px;
    /* æ»šåŠ¨æ¡ç¾åŒ–ï¼ˆWebkitå†…æ ¸æµè§ˆå™¨æœ‰æ•ˆï¼‰ */
    scrollbar-width: thin;
    scrollbar-color: #d1c4b8 transparent;
}

/* æ—¥å¿—é¢æ¿ï¼šå¢åŠ å†…é˜´å½±å’Œçº¸å¼ æ„Ÿ */
.log-panel { 
    flex: 1; 
    background: #fff; 
    color: #444; 
    padding: 15px; 
    border-radius: 8px; 
    overflow-y: auto; 
    font-size: 13px; 
    border: 1px solid var(--border-color); 
    box-shadow: inset 0 2px 6px rgba(0,0,0,0.03); /* æŸ”å’Œå†…é˜´å½± */
}
.log-entry { margin-bottom: 8px; border-bottom: 1px dashed #eee; padding-bottom: 4px; line-height: 1.5; }
        .log-time { color: #7f8c8d; font-size: 11px; font-weight: bold; margin-right: 5px; background: #f0f0f0; padding: 1px 4px; border-radius: 3px; }
        /* === 3. æŒ‰é’®äº¤äº’å‡çº§ (åŸºç¡€æ ·å¼) === */
.btn { 
    padding: 6px 14px; 
    border: none; 
    border-radius: 6px;       /* æ›´åœ†æ¶¦çš„è¾¹è§’ */
    cursor: pointer; 
    transition: all 0.2s cubic-bezier(0.25, 0.8, 0.25, 1); /* ä¸æ»‘åŠ¨ç”» */
    font-size: 13px; 
    margin: 3px;
    font-weight: 500;
    position: relative;
    overflow: hidden;
    /* é»˜è®¤ç»™ä¸ªææ·¡çš„é˜´å½± */
    box-shadow: 0 2px 4px rgba(0,0,0,0.1); 
    font-family: "Microsoft YaHei", sans-serif; /* ç¡®ä¿æŒ‰é’®å­—ä½“ä¹Ÿå¥½çœ‹ */
}

/* æ‚¬åœæ•ˆæœï¼šä¸Šæµ® + é˜´å½±åŠ æ·± + äº®åº¦æå‡ */
.btn:hover { 
    transform: translateY(-2px); 
    box-shadow: 0 5px 10px rgba(0,0,0,0.15); 
    filter: brightness(1.05); 
}

/* ç‚¹å‡»æ•ˆæœï¼šä¸‹æ²‰ */
.btn:active {
    transform: translateY(0);
    box-shadow: 0 2px 3px rgba(0,0,0,0.1); 
}
       .player-panel { 
    background: #fff; 
    padding: 20px; /* ç¨å¾®åŠ å¤§å†…è¾¹è· */
    border-radius: 10px; 
    box-shadow: 0 4px 15px rgba(0,0,0,0.05); /* æ¼‚äº®çš„æŠ•å½± */
    margin-bottom: 20px; 
    border-left: 5px solid var(--main-color); /* ä¿ç•™å·¦ä¾§å¼ºè°ƒçº¿ */
    border-top: 1px solid var(--border-color);
    border-right: 1px solid var(--border-color);
    border-bottom: 1px solid var(--border-color);
    position: relative;
}
.stats-bar { display: flex; gap: 20px; margin-top: 10px; background: #f9f9f9; padding: 10px; border-radius: 5px; }
        .stat-item { display: flex; flex-direction: column; align-items: center; font-size: 12px; }
        .stat-item strong { font-size: 16px; color: var(--main-color); }
        .family-area { margin-top: 10px; border-top: 1px dashed #ddd; padding-top: 10px; }
        .child-token { display: inline-block; padding: 4px 10px; margin: 3px; border-radius: 15px; font-size: 12px; background: #eee; border: 1px solid #ccc; cursor: pointer; transition: 0.2s; }
        .child-token.girl { background: #fff0f5; color: #d63384; border-color: #ffc2d1; }
        .child-token.boy { background: #f0f8ff; color: #0d6efd; border-color: #b6d4fe; }
        .section-title { border-bottom: 2px solid #ddd; padding-bottom:10px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; }
        .npc-list { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 15px; }
        .npc-card { 
    background-color: #fff;
    border: 1px solid var(--border-color); /* ä½¿ç”¨æ–°çš„æ·¡è¾¹æ¡† */
    border-radius: 10px; 
    padding: 12px; 
    cursor: pointer; 
    transition: all 0.3s ease; 
    position: relative; 
    box-shadow: 0 2px 6px rgba(0,0,0,0.03); /* é»˜è®¤è½»å¾®é˜´å½± */
}
.npc-card:hover { 
    transform: translateY(-4px); 
    box-shadow: 0 8px 20px rgba(0,0,0,0.12); /* æ‚¬åœæµ®èµ·æ„Ÿæ›´å¼º */
    border-color: var(--main-color); 
}
.npc-card.female { background-color: #fff5f7; }
        .npc-card.male { background-color: #f0f8ff; }
        .npc-card.imprisoned { background-color: #596275 !important; border-color: #2c3e50; color: #ecf0f1; }
        .npc-card.imprisoned .npc-name { color: #bdc3c7; }
        /* index.html - <style> åŒºåŸŸ */

        /* ... åŸæœ‰çš„æ ·å¼ ... */

        /* ã€æ–°å¢ã€‘å…¥é­”å¡ç‰‡æ ·å¼ï¼šé»‘çº¢æ¸å˜èƒŒæ™¯ï¼Œè¾¹æ¡†å˜çº¢ï¼Œæ–‡å­—å˜ç™½ */
        .npc-card.demonic {
            background: linear-gradient(135deg, #2c0000 0%, #4a0000 100%);
            border: 1px solid #c0392b;
            color: #ecf0f1;
            box-shadow: 0 0 10px rgba(192, 57, 43, 0.5);
        }
        /* å…¥é­”å¡ç‰‡é‡Œçš„åå­—é¢œè‰² */
        .npc-card.demonic .npc-name {
            color: #ff4d4d;
            text-shadow: 0 0 5px #ff0000;
        }
        /* å…¥é­”å¡ç‰‡é‡Œçš„ Realm (å¢ƒç•Œ) æ–‡å­—é¢œè‰² */
        .npc-card.demonic div {
            color: #bdc3c7; 
        }

        /* ã€æ–°å¢ã€‘å…¥é­”å¾½ç« æ ·å¼ï¼šé»‘è‰²èƒŒæ™¯ï¼Œçº¢è‰²å­— */
        .badge-demon {
            background: #000;
            border: 1px solid #c0392b;
            color: #c0392b;
            font-weight: bold;
            animation: pulse-red 2s infinite; /* å‘¼å¸ç¯ç‰¹æ•ˆ */
        }

        /* å®šä¹‰ä¸€ä¸ªç®€å•çš„å‘¼å¸åŠ¨ç”» */
        @keyframes pulse-red {
            0% { box-shadow: 0 0 0 0 rgba(192, 57, 43, 0.7); }
            70% { box-shadow: 0 0 0 5px rgba(192, 57, 43, 0); }
            100% { box-shadow: 0 0 0 0 rgba(192, 57, 43, 0); }
        }
        .status-badge { position: absolute; top: 10px; right: 10px; font-size: 10px; padding: 2px 5px; border-radius: 4px; color: white; }
        .badge-spouse { background: #e74c3c; }
        .badge-preg { background: #9b59b6; }
        .badge-jail { background: #2c3e50; border: 1px solid #fff; }
        .badge-nemesis { background: #c0392b; border: 1px solid #fff; }
        .badge-lovehate { background: #e056fd; border: 1px solid #fff; }
        .modal-overlay { display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.5); z-index: 100; justify-content: center; align-items: center; }
        .modal { background: #fff; width: 400px; padding: 20px; border-radius: 8px; box-shadow: 0 10px 25px rgba(0,0,0,0.3); }
        /* ================== è§’è‰²è¯¦æƒ…å¼¹çª—æ•´ä½“å¸ƒå±€ï¼ˆopenDetail å¯¹åº”çš„å¼¹çª—ï¼‰ ================== */
        /* å®½çŸ©å½¢å¼¹çª—ï¼šé™åˆ¶æœ€å¤§å®½åº¦ä¸º 850pxï¼Œä¿è¯å¤§éƒ¨åˆ†å†…å®¹ä¸éœ€è¦æ»šåŠ¨å³å¯çœ‹åˆ° */
        .modal-detail {
            max-width: 850px;
            width: 90%;
            display: flex;                 /* ä¸‰æ æ•´ä½“å®¹å™¨ */
            gap: 16px;
            padding: 20px 24px;
            position: relative;
        }
        /* å·¦ä¾§ï¼šåå­— + åŸºæœ¬æè¿°åŒºåŸŸ */
        .detail-left {
            flex: 1.2;
            border-right: 1px dashed #eee;
            padding-right: 16px;
        }
        /* ä¸­é—´ï¼šå±æ€§åˆ†å—å±•ç¤ºåŒºåŸŸï¼ˆåŸºç¡€ / æ•°å€¼ / æƒ…æ„Ÿï¼‰ */
        .detail-center {
            flex: 1.5;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        /* æ¯ä¸€å—å±æ€§çš„å°å¡ç‰‡ï¼šæ·¡åº•è‰² + ç»†è¾¹æ¡†ï¼Œæ–¹ä¾¿è§†è§‰åˆ†ç»„ */
        .detail-attr-section {
            background: #f9f6ff;
            border: 1px solid #e0d7ff;
            border-radius: 6px;
            padding: 8px 10px;
        }
        .detail-attr-title {
            font-size: 13px;
            font-weight: bold;
            color: #7e57c2;
            margin-bottom: 4px;
        }
        .detail-attr-row {
            display: flex;
            justify-content: space-between;
            font-size: 13px;
            padding: 2px 0;
        }
        /* å³ä¾§ï¼šäº¤äº’æŒ‰é’®æ ï¼ˆäº¤è°ˆ / èµ ç¤¼ ç­‰ï¼‰ */
        .detail-right {
            flex: 0.9;
            display: flex;
            flex-direction: column;
            align-items: stretch;
            border-left: 1px dashed #eee;
            padding-left: 16px;
        }
        .detail-right-title {
            font-size: 13px;
            font-weight: bold;
            color: #444;
            margin-bottom: 6px;
        }
        /* äº¤äº’æŒ‰é’®å®¹å™¨ï¼šç«–å‘æ’åˆ—ï¼Œè®©æŒ‰é’®æ›´æ˜¾çœ¼ */
        .modal-actions {
            display: flex;
            flex-direction: column;
            gap: 8px;
            margin-top: 4px;
            align-items: stretch;
        }
        /* æ”¾å¤§äº¤äº’æŒ‰é’®å°ºå¯¸ï¼Œç»Ÿä¸€æˆâ€œä¸»æ“ä½œåŒºâ€çš„è§†è§‰é‡é‡ */
        .modal-actions .btn {
            width: 100%;
            font-size: 14px;
            padding: 8px 12px;
        }
        /* ç©å®¶è¯¦æƒ…ä¸“ç”¨ï¼šéšè—å³ä¾§äº’åŠ¨æ  + éšè—æƒ…æ„Ÿå—ï¼ˆç©å®¶ä¸éœ€è¦â€œå¯¹ä½ æ€åº¦/çˆ±æ„/é»‘åŒ–â€ï¼‰ */
        .modal-detail.is-player .detail-right { display: none; }
        .modal-detail.is-player .detail-attr-emotion { display: none; }
        /* ç©å®¶éšè—å³æ åï¼Œè®©ä¸­é—´å±æ€§åŒºæ›´å®½ä¸€äº› */
        .modal-detail.is-player .detail-center { flex: 2.2; }
        /* åŸæœ‰çš„å±æ€§ç½‘æ ¼æ ·å¼ï¼Œä¿ç•™ç»™å…¶å®ƒå¼¹çª—ä½¿ç”¨ */
        .modal-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-bottom: 15px; }
        .modal-row { display: flex; justify-content: space-between; font-size: 14px; border-bottom: 1px dashed #eee; padding: 5px 0; }
        .modal-actions-legacy { display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 20px; }
        
        .btn-talk { background: #e3f2fd; color: #2980b9; }
        .btn-gift { background: #e8f5e9; color: #27ae60; }
        .btn-steal { background: #fff3e0; color: #e67e22; }
        .btn-attack { background: #ffebee; color: #c0392b; }
        .btn-kill { background: #2c3e50; color: #e74c3c; grid-column: span 2; font-weight: bold; }
        .btn-kidnap { background: #34495e; color: #fff; grid-column: span 2; font-weight: bold; border: 1px dashed #fff; }
        .btn-release { background: #1abc9c; color: #fff; grid-column: span 2; }
        .btn-marry { background: #fce4ec; color: #c2185b; grid-column: span 2; font-weight:bold; border: 1px solid #f8bbd0; animation: pulse 1s infinite; }
        .btn-divorce { background: #95a5a6; color: #fff; grid-column: span 2; }
        .btn-divorce-force { background: #d35400; color: #fff; grid-column: span 2; font-weight:bold;}
        .btn-baby { background: #f3e5f5; color: #7b1fa2; grid-column: span 2; font-weight: bold;} 
        .btn-force { background: #4a148c; color: #fff; grid-column: span 2; font-weight: bold; border: 1px solid #ab47bc; }
        .btn-inv { position: absolute; top: 15px; right: 15px; background: #f39c12; color: white; font-size: 12px; }
        /* index.html å¢åŠ ä¸€ä¸ªæŒ‰é’®é¢œè‰² */
        .btn-persuade { background: #fdfae3; color: #856404; border: 1px solid #ffeeba; }
        @keyframes pulse { 0% { transform: scale(1); } 50% { transform: scale(1.02); } 100% { transform: scale(1); } }
        .tag { font-size: 10px; padding: 2px 5px; border-radius: 3px; color: #fff; display: inline-block; margin-right: 3px; }
        .tag.god { background: linear-gradient(45deg, #9b59b6, #e056fd); box-shadow: 0 0 5px #e056fd; }
        .tag.good { background-color: #27ae60; }
        .tag.bad { background-color: #c0392b; }
        .tag.neutral { background-color: #95a5a6; }
        .personality-label { font-size: 10px; background: rgba(0,0,0,0.05); color: #666; padding: 1px 4px; border-radius: 3px; vertical-align: middle; }
        .realm-badge { background: #2c3e50; color: #f1c40f; padding: 2px 6px; border-radius: 4px; font-size: 11px; font-weight: bold; margin-left: 5px; border: 1px solid #f1c40f;}
        .inv-item { background: #f9f9f9; padding: 8px; border-bottom: 1px solid #eee; display:flex; justify-content:space-between; align-items:center; }
        .inv-item:last-child { border-bottom: none; }
        #startScreen { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #f3f0f5; z-index: 200; display: flex; flex-direction: column; align-items: center; justify-content: center; }
        .start-card { background: white; padding: 30px; border-radius: 10px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); width: 300px; text-align: center; }
        .start-stat { display: flex; justify-content: space-between; margin: 10px 0; border-bottom: 1px solid #eee; padding: 5px 0;}
        /* â–¼â–¼â–¼ æ–°å¢ï¼šè®ºé“/æ´—è„‘ (Dao Brainwash) æ ·å¼ â–¼â–¼â–¼ */
        /* æ³¨æ„ï¼šè¿™é‡Œå¤ç”¨äº†ä½ åŸæœ‰çš„ .modal-overlayï¼Œä½†å¢å¼ºäº†æ•ˆæœ */
        #dao-modal.modal-overlay {
            position: fixed;
            background: rgba(0, 0, 0, 0.85); /* æ›´é»‘çš„èƒŒæ™¯ */
            backdrop-filter: blur(4px);      /* æ¨¡ç³ŠèƒŒæ™¯ï¼Œåˆ¶é€ è™šç©ºæ„Ÿ */
            z-index: 2000;                   /* ç¡®ä¿åœ¨æœ€ä¸Šå±‚ (æ¯”æ™®é€š modal é«˜) */
        }

        /* 2. æš—é»‘é£é¢æ¿å®¹å™¨ (åŒºåˆ«äºä½ åŸæœ¬ç™½è‰²çš„ .modal) */
        .modal-content {
            background: #1a1a1a;            /* æ·±ç°/é»‘èƒŒæ™¯ */
            border: 1px solid #4a4a4a;      /* ç°è‰²è¾¹æ¡† */
            box-shadow: 0 0 25px rgba(0, 0, 0, 0.9); /* æ·±é‚ƒé˜´å½± */
            width: 420px;
            padding: 25px;
            border-radius: 6px;
            color: #ccc;                    /* æµ…ç°æ–‡å­— */
            font-family: "Microsoft YaHei", sans-serif;
            position: relative;             /* ç¡®ä¿å†…å®¹å®šä½æ­£ç¡® */
        }

        /* 3. é¡¶éƒ¨æ ‡é¢˜æ  */
        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            border-bottom: 1px solid #333;
            padding-bottom: 15px;
            margin-bottom: 20px;
        }

        .modal-header h3 {
            margin: 0;
            color: #e0e0e0;
            font-size: 20px;
            letter-spacing: 2px; /* å­—é—´è·ï¼Œå¢åŠ å¤ç±æ„Ÿ */
        }

        .close-btn {
            cursor: pointer;
            font-size: 24px;
            color: #666;
            transition: color 0.2s;
            line-height: 1;
        }
        .close-btn:hover { color: #fff; }

        /* 4. ä¸­é—´æ–‡å­—æç¤º */
        #dao-target-name {
            text-align: center;
            color: #888;
            font-size: 14px;
            margin-bottom: 20px;
            font-style: italic;
        }

        /* 5. æŒ‰é’®ç½‘æ ¼å¸ƒå±€ (2åˆ— x 3è¡Œ) */
        .dao-grid {
            display: grid;
            grid-template-columns: 1fr 1fr; /* ä¸¤åˆ—ç­‰å®½ */
            gap: 15px;                      /* é—´è· */
        }

        /* 6. æ ¸å¿ƒæŒ‰é’®æ ·å¼ */
        .dao-btn {
            padding: 15px;
            border: 1px solid #333;
            background: #252525;
            color: #aaa;
            cursor: pointer;
            text-align: left;
            transition: all 0.2s ease;
            border-radius: 4px;
            position: relative;
            overflow: hidden;
        }

        /* æ‚¬åœæ•ˆæœï¼šä¸Šæµ® + å˜äº® */
        .dao-btn:hover {
            background: #333;
            transform: translateY(-2px);
        }

        /* æŒ‰é’®å†…çš„æ ‡é¢˜ */
        .btn-title {
            display: block;
            font-size: 18px;
            font-weight: bold;
            margin-bottom: 5px;
        }

        /* æŒ‰é’®å†…çš„æè¿°å°å­— */
        .btn-desc {
            display: block;
            font-size: 12px;
            opacity: 0.6;
        }

        /* === å…‰æ˜/æ­£é“ (å·¦åˆ—) æ ·å¼ === */
        .dao-btn.light .btn-title { color: #f1c40f; } /* é‡‘è‰² */
        .dao-btn.light:hover {
            border-color: #f1c40f;
            box-shadow: 0 0 10px rgba(241, 196, 15, 0.15);
        }

        /* === é»‘æš—/é­”é“ (å³åˆ—) æ ·å¼ === */
        .dao-btn.dark .btn-title { color: #9b59b6; }  /* ç´«è‰² */
        .dao-btn.dark:hover {
            border-color: #9b59b6;
            box-shadow: 0 0 10px rgba(155, 89, 182, 0.15);
        }
    /* --- å®¶æ—æ ‘ä¸“ç”¨æ ·å¼ --- */
.tree ul {
    padding-top: 20px; position: relative;
    transition: all 0.5s;
    -webkit-transition: all 0.5s;
    -moz-transition: all 0.5s;
    display: flex; justify-content: center; /* å±…ä¸­å¯¹é½ */
}

.tree li {
    float: left; text-align: center;
    list-style-type: none;
    position: relative;
    padding: 20px 5px 0 5px;
    transition: all 0.5s;
    -webkit-transition: all 0.5s;
    -moz-transition: all 0.5s;
}

/* è¿æ¥çº¿é€»è¾‘ */
.tree li::before, .tree li::after {
    content: ''; position: absolute; top: 0; right: 50%;
    border-top: 1px solid #ccc; width: 50%; height: 20px;
}
.tree li::after {
    right: auto; left: 50%; border-left: 1px solid #ccc;
}
.tree li:only-child::after, .tree li:only-child::before {
    display: none;
}
.tree li:only-child { padding-top: 0; }
.tree li:first-child::before, .tree li:last-child::after {
    border: 0 none;
}
.tree li:last-child::before{
    border-right: 1px solid #ccc;
    border-radius: 0 5px 0 0;
}
.tree li:first-child::after{
    border-radius: 5px 0 0 0;
}

/* ä¸‹è¡Œè¿æ¥çº¿ */
.tree ul ul::before{
    content: ''; position: absolute; top: 0; left: 50%;
    border-left: 1px solid #ccc; width: 0; height: 20px;
}

.tree-member {
    border: 1px solid #bdc3c7; 
    padding: 8px;
    text-decoration: none; 
    color: #666;
    font-family: "Microsoft YaHei", sans-serif;
    font-size: 12px; 
    display: inline-block;
    border-radius: 6px; 
    transition: all 0.3s;
    background: #fff; 
    cursor: pointer;
    min-width: 100px; /*ç¨å¾®å®½ä¸€ç‚¹ï¼Œå®¹çº³æ›´å¤šä¿¡æ¯*/
    position: relative; /* ä¸ºäº†æ”¾å³ä¸Šè§’çš„å¾½ç«  */
    box-shadow: 0 2px 5px rgba(0,0,0,0.05);
}

/* æ‚¬åœæ•ˆæœï¼šæµ®èµ· + é˜´å½±åŠ æ·± */
.tree-member:hover { 
    transform: translateY(-3px);
    box-shadow: 0 5px 15px rgba(0,0,0,0.15);
    z-index: 10;
}

/* æ€§åˆ«èƒŒæ™¯è‰²åŒºåˆ† */
.tree-girl {
    background: #fff0f5; /* æµ…ç²‰èƒŒæ™¯ */
    border-color: #ffc2d1;
}
.tree-boy {
    background: #f0f8ff; /* æµ…è“èƒŒæ™¯ */
    border-color: #b6d4fe;
}

/* é…å¶æ æ ·å¼ä¼˜åŒ– */
.tree-member .spouse { 
    font-size: 11px; 
    display: block; 
    border-top: 1px solid rgba(0,0,0,0.05); 
    margin-top: 4px; 
    padding-top: 2px;
}
    /* æ–°å¢ï¼šå¼¹çª—åŠ¨ç”»ä¸æ¯›ç»ç’ƒ */
@keyframes modalPop {
    0% { transform: scale(0.8); opacity: 0; }
    100% { transform: scale(1); opacity: 1; }
}

/* è¦†ç›–åŸæœ‰çš„ overlay æ ·å¼ï¼Œå¢åŠ æ¨¡ç³Šæ„Ÿ */
.modal-overlay {
    background: rgba(0, 0, 0, 0.6) !important; /* ç¨å¾®åŠ æ·± */
    backdrop-filter: blur(5px); /* æ¯›ç»ç’ƒæ ¸å¿ƒä»£ç  */
    -webkit-backdrop-filter: blur(5px);
}

/* ä¼˜åŒ–å¼¹çª—æ–‡å­— */
.modal h3 { font-family: "Microsoft YaHei", sans-serif; letter-spacing: 1px; }
/* === è‡ªå®šä¹‰å¼¹çª—æ ·å¼ === */
#game-modal {
    background-color: #fdf5e6; /* ç±³è‰²å®£çº¸åº•è‰² */
    border: 3px double #5d4037; /* æ·±æ£•è‰²åŒçº¿è¾¹æ¡† */
    border-radius: 8px;
    padding: 20px;
    min-width: 300px;
    max-width: 400px;
    box-shadow: 0 10px 25px rgba(0,0,0,0.5);
    font-family: "Microsoft YaHei", serif;
    color: #3e2723;
    z-index: 10000;
}

#game-modal::backdrop {
    background-color: rgba(0, 0, 0, 0.6); /* èƒŒæ™¯å˜æš— */
    backdrop-filter: blur(2px); /* èƒŒæ™¯æ¨¡ç³Š */
}

#modal-title {
    margin-top: 0;
    color: #c0392b; /* æœ±çº¢è‰²æ ‡é¢˜ */
    border-bottom: 1px solid #d7ccc8;
    padding-bottom: 10px;
    text-align: center;
}

#modal-content {
    margin: 15px 0;
    line-height: 1.6;
    font-size: 1.1em;
}

#modal-input {
    width: 100%;
    padding: 8px;
    margin-bottom: 15px;
    border: 1px solid #8d6e63;
    border-radius: 4px;
    background: #fff8e1;
    font-size: 1em;
    display: none; /* é»˜è®¤éšè— */
    box-sizing: border-box;
}

.modal-buttons {
    display: flex;
    justify-content: flex-end;
    gap: 10px;
}

.modal-btn {
    padding: 8px 20px;
    border: none;
    border-radius: 4px;
    cursor: pointer;
    font-weight: bold;
    transition: all 0.2s;
}

#btn-confirm {
    background-color: #5d4037;
    color: #fdf5e6;
}
#btn-confirm:hover { background-color: #3e2723; }

#btn-cancel {
    background-color: #d7ccc8;
    color: #5d4037;
    display: none; /* é»˜è®¤éšè— */
}
#btn-cancel:hover { background-color: #bcaaa4; }
    /* --- å¼€åœºæ•…äº‹ç•Œé¢æ ·å¼ (ç‚¹å‡»åˆ‡æ¢ç‰ˆ) --- */
        #introScreen {
            display: none;
            position: fixed;
            top: 0; left: 0; width: 100%; height: 100%;
            background: #000;
            z-index: 2000;
            /* ä½¿ç”¨ Flex å¸ƒå±€è®©æ–‡å­—ç»å¯¹å±…ä¸­ */
            display: none; /* JSæ§åˆ¶æ˜¾ç¤ºæ—¶æ”¹ä¸º flex */
            flex-direction: column;
            justify-content: center;
            align-items: center;
            cursor: pointer; /* é¼ æ ‡å˜æ‰‹å‹ï¼Œæç¤ºå¯ç‚¹å‡» */
        }
        
        .story-container {
            width: 80%;
            max-width: 800px;
            text-align: center;
            min-height: 100px; /* å ä¸ªä½é˜²æ­¢è·³åŠ¨ */
        }
        
        .story-line {
            font-size: 26px; /* å­—ä½“åŠ å¤§ */
            line-height: 1.8;
            color: #fff;
            font-family: "KaiTi", "æ¥·ä½“", serif;
            /* æ·¡å…¥åŠ¨ç”» */
            opacity: 0;
            animation: textFadeIn 1s ease-out forwards;
        }

        @keyframes textFadeIn {
            from { opacity: 0; transform: translateY(20px); }
            to { opacity: 1; transform: translateY(0); }
        }

        /* åº•éƒ¨çš„å°æç¤º */
        .click-hint {
            position: absolute;
            bottom: 50px;
            color: #666;
            font-size: 14px;
            letter-spacing: 2px;
            animation: blink 2s infinite;
        }

        @keyframes blink {
            0%, 100% { opacity: 0.3; }
            50% { opacity: 1; }
        }

        /* è·³è¿‡æŒ‰é’®æ”¾å³ä¸Šè§’ */
        .skip-btn {
            position: absolute;
            top: 30px;
            right: 30px;
            padding: 8px 15px;
            background: transparent;
            border: 1px solid #444;
            color: #888;
            cursor: pointer;
            font-size: 14px;
            z-index: 2001;
            transition: 0.3s;
        }
        .skip-btn:hover {
            border-color: #fff;
            color: #fff;
        }
    </style>
</head>
<div id="dev-console" style="position:fixed; right:10px; top:50%; transform:translateY(-50%); background:rgba(0,0,0,0.8); color:white; padding:10px; border-radius:8px; z-index:9999; display:none; font-size:12px;">
    <h4 style="margin:0 0 10px 0; color:#f1c40f;">é€ ç‰©ä¸»é¢æ¿</h4>
    <button onclick="devAddStones()">çµçŸ³+1000</button><br>
    <button onclick="devAddPower()">ä¿®ä¸º+5000</button><br>
    <button onclick="devFullAP()">ç²¾åŠ›è¡¥æ»¡</button><br>
    <hr>
    <button onclick="document.getElementById('dev-console').style.display='none'">å…³é—­</button>
</div>
<body>
    <div id="startScreen">
        <div class="start-card">
            <h2 style="color:var(--main-color)">å®¶æ—ä¿®ä»™å½•</h2>
            <p>åˆ›å»ºä½ çš„è§’è‰²</p>
            <div id="rollStats" style="display:flex; justify-content:space-around; align-items:center; background:#fafafa; padding:15px 5px; border-radius:5px; margin-bottom:15px;">
                
                <div style="text-align:center; flex:1;">
                    <div style="font-size:12px; color:#777; margin-bottom:5px;">çµåŠ›èµ„è´¨</div>
                    <div style="font-size:24px; font-weight:bold; color:#d35400; display:flex; align-items:center; justify-content:center;">
                        <span id="rollPower">0</span>
                        <span id="lockPower" onclick="toggleLock('power')" 
                              style="cursor:pointer; font-size:16px; margin-left:8px; opacity:0.3; transition:all 0.2s;" 
                              title="ç‚¹å‡»é”å®š/è§£é”">ğŸ”“</span>
                    </div>
                </div>

                <div style="width:1px; height:30px; background:#ddd;"></div>

                <div style="text-align:center; flex:1;">
                    <div style="font-size:12px; color:#777; margin-bottom:5px;">å…ˆå¤©æ™ºåŠ›</div>
                    <div style="font-size:24px; font-weight:bold; color:#2980b9; display:flex; align-items:center; justify-content:center;">
                        <span id="rollInt">0</span>
                        <span id="lockInt" onclick="toggleLock('int')" 
                              style="cursor:pointer; font-size:16px; margin-left:8px; opacity:0.3; transition:all 0.2s;" 
                              title="ç‚¹å‡»é”å®š/è§£é”">ğŸ”“</span>
                    </div>
                </div>

                <div style="width:1px; height:30px; background:#ddd;"></div>

                <div style="text-align:center; flex:1;">
                    <div style="font-size:12px; color:#777; margin-bottom:5px;">å®¹è²Œé­…åŠ›</div>
                    <div style="font-size:24px; font-weight:bold; color:#e91e63; display:flex; align-items:center; justify-content:center;">
                        <span id="rollCharm">0</span>
                        <span id="lockCharm" onclick="toggleLock('charm')" 
                              style="cursor:pointer; font-size:16px; margin-left:8px; opacity:0.3; transition:all 0.2s;" 
                              title="ç‚¹å‡»é”å®š/è§£é”">ğŸ”“</span>
                    </div>
                </div>
            </div>
            <button class="btn" style="background:var(--accent-color); color:white; width:100%; margin-bottom:10px;" 
    onmouseover="window.playSound('hover')" 
    onclick="window.rollStats()">ğŸ² éšæœºå±æ€§ (Roll)</button>

<button class="btn" style="background:var(--main-color); color:white; width:100%; font-weight:bold; font-size:16px;" 
    onmouseover="window.playSound('hover')" 
    onclick="playIntro()">ğŸš€ è¸å…¥ä»™é€”</button>

<button class="btn" style="background:#95a5a6; color:white; width:100%; margin-top:5px;" 
    onmouseover="window.playSound('hover')" 
    onclick="window.loadGame(true)">ğŸ“‚ è¯»å–æ—§å­˜æ¡£</button>
        </div>
    
    </div>
<div id="introScreen" onclick="showNextIntro()">
        
        <div id="storyContent" class="story-container">
            </div>

        <div class="click-hint">â€”â€” ç‚¹å‡»å±å¹•ç»§ç»­ â€”â€”</div>

        <button class="skip-btn" onclick="event.stopPropagation(); endIntro()">è·³è¿‡ >></button>
    </div>
    <div id="charCreator" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.85); z-index:150; align-items:center; justify-content:center; backdrop-filter: blur(5px);">
        
        <div class="modal" style="width: 900px; max-width: 95vw; height: 600px; padding: 0; display: flex; overflow: hidden; border-radius: 12px;">
            
            <div style="flex: 6; padding: 30px; display: flex; flex-direction: column; background: #fff; border-right: 1px solid #eee;">
                
                <h3 style="color:var(--main-color); margin-top:0; border-bottom: 2px solid #f0f0f0; padding-bottom: 10px;">âœ¨ å¡‘é€ é‡‘èº«</h3>
                <p style="font-size:13px; color:#666; margin-bottom:20px;">äº‘é›¾è¡¡ï¼Œè¯·æç»˜ä½ çš„å®¹è²Œ...</p>
                
                <div id="creatorControls" style="display:grid; grid-template-columns: 1fr 1fr; gap: 15px; overflow-y: auto; padding-right: 10px; flex: 1; align-content: start;">
                    </div>

                <button class="btn" style="background:var(--main-color); color:white; width:100%; font-weight:bold; padding:15px; margin-top: 20px; font-size: 16px; box-shadow: 0 4px 10px rgba(142, 68, 173, 0.3);" 
                    onmouseover="window.playSound('hover')" 
                    onclick="window.finishCreator()">
                    ğŸ”® å¡‘å½¢å®Œæˆï¼Œå…¥ä¸–ï¼
                </button>
            </div>
            <div style="flex: 4; background: #f8f9fa; padding: 30px; display: flex; flex-direction: column; align-items: center; justify-content: center; border-left: 1px solid #e0e0e0; position: relative;">
                
                <div style="font-weight:bold; color:#333; margin-bottom: 20px; font-size: 16px;">å½“å‰é¢„è§ˆ</div>

                <div id="charAvatarPreview" style="margin-bottom: 25px; filter: drop-shadow(0 5px 15px rgba(0,0,0,0.15));"></div>

               

                <div id="creatorPreview" style="font-size:12px; color:#555; line-height: 1.6; background: white; padding: 15px; border-radius: 8px; width: 100%; box-sizing: border-box; border: 1px dashed #ccc; text-align: justify;">
                    </div>

            </div>
        </div>
    </div>

    <div class="game-area">
        <div class="player-panel">
            <button class="btn btn-inv" onclick="window.openInventory()">ğŸ’ å‚¨ç‰©</button>
            <button class="btn btn-inv" style="right: 90px; background:#2c3e50;" onclick="window.saveGame()">ğŸ’¾ å­˜æ¡£</button>
            <button class="btn btn-inv" style="right: 150px; background:#2c3e50;" onclick="window.loadGame()">ğŸ“‚ è¯»æ¡£</button>
            <button class="btn btn-inv" style="right: 210px; background:#7f8c8d;" onclick="window.openSettings()">âš™ï¸ è®¾ç½®</button>
            <button class="btn btn-inv" style="right: 270px; background:#8e44ad;" onclick="window.triggerActiveSeize()">ğŸ§¬ ä¼ æ‰¿</button>
            <button class="btn btn-inv" style="right: 330px; background:#27ae60;" onclick="window.exportSave()">ğŸ“¤ å¯¼å‡º</button>
            <button class="btn btn-inv" style="right: 390px; background:#d35400;" onclick="window.importSave()">ğŸ“¥ å¯¼å…¥</button>
            <div style="display:flex; justify-content:space-between; align-items:center;">
                <div style="display:flex; align-items:center;">
                    <div id="pAvatarDisplay" style="margin-right: 15px;"></div>
                    
                    <div>
                        <span style="font-size: 22px; font-weight: bold; cursor:pointer; border-bottom:1px dashed #ccc;" id="pName" onclick="window.openPlayerDetail()"></span>
                        <span class="tag god">å¤©å‡¤è¡€è„‰</span>
                    </div>
                </div>
                <div style="text-align:right; margin-right: 270px;"> 
                    <div style="font-size:18px; font-weight:bold; color:#2c3e50" id="pAgeDisplay"></div>
                    <div style="font-size:12px; color:#7f8c8d" id="gameTime"></div>
                </div>
            </div>
            <div class="stats-bar">
                <div class="stat-item"><strong>å¢ƒç•Œ</strong><span id="pRealm" style="color:#d35400; font-weight:bold;">å‡¡äºº</span></div>
                <div class="stat-item"><strong>ç²¾åŠ›</strong><span id="pAP" style="color:#f1c40f; font-weight:bold;">3/3</span></div>
                <div class="stat-item"><strong>ä¿®ä¸º</strong><span id="pPower">0</span></div>
                <div class="stat-item"><strong>æ™ºåŠ›</strong><span id="pInt">0</span></div>
                <div class="stat-item"><strong>é­…åŠ›</strong><span id="pCharm">0</span></div>
                <div class="stat-item"><strong>å¤«å›</strong><span id="pSpouse">æ— </span></div>
            </div>
            <div class="family-area">
                <div style="font-size:12px; color:#555; margin-bottom:5px; display:flex; justify-content:space-between; align-items:center;">
    <span>ğŸ‘¶ å®¶æ—å­å—£ (æ˜é¢å·²è®¤):</span>
    <button class="btn" style="background:#8e44ad; color:white; font-size:10px; padding:2px 8px;" onclick="window.openFamilyTree()">ğŸŒ³ æŸ¥çœ‹æ—è°±</button>
</div>
                <div id="childrenList"></div>
            </div>
        </div>
        <div class="section-title">
            <span>ğŸ“ å½“å‰åœºæ™¯äººç‰©</span>
            <button class="btn" style="background:#3498db; color:white;" onclick="window.nextTurn()">ğŸŒ™ é—­å…³ä¸€æœˆ (ä¸‹ä¸ªæœˆ)</button>
        </div>
        <div id="npcList" class="npc-list"></div>
    </div>

    <div class="log-panel" id="gameLog">
        <div class="log-entry">--- ç„é»„ç•Œç¼–å¹´å² ---</div>
    </div>

    <div class="modal-overlay" id="detailModal" onclick="if(event.target===this) window.closeModal()">
        <!-- =================== è§’è‰²è¯¦æƒ…å¼¹çª—ï¼ˆä¸‰æ å¸ƒå±€ï¼‰ =================== -->
        <!-- æ•´ä½“å¼¹çª—å®¹å™¨ï¼šå®½çŸ©å½¢ + ä¸‰æ å¸ƒå±€ -->
        <div class="modal modal-detail">
            <!-- é¡¶éƒ¨å³ä¸Šè§’å…³é—­æŒ‰é’®ï¼ˆæ•´ä¸ªå¼¹çª—ç»Ÿä¸€çš„å…³é—­äº¤äº’ï¼‰ -->
            <div style="position:absolute; top:12px; right:18px; cursor:pointer; font-size:20px; color:#999;" onclick="window.closeModal()">Ã—</div>

            <!-- ========= å·¦ä¾§ï¼šè§’è‰²åå­— + èº«ä»½æè¿°åŒºåŸŸ ========= -->
            <!-- æ˜¾ç¤ºè§’è‰²å§“åã€æ€§æ ¼æ ‡ç­¾ã€æ€§åˆ«å¹´é¾„ã€å¢ƒç•Œå¾½ç« ã€å¤–è²Œæè¿°ã€ç‰¹è´¨æ ‡ç­¾ç­‰ -->
            <div class="detail-left">
                <div style="font-size:20px; font-weight:bold; color:var(--main-color); margin-bottom:4px;">
                    <span id="mName"></span>
                    <span id="mPersonality" class="personality-label"></span>
                </div>
                <div style="color:#666; font-size:13px; margin-bottom:6px;">
                    <span id="mGender"></span> Â· <span id="mAge"></span>å²
                    <span id="mRealmBadge" class="realm-badge"></span>
                </div>
                <div id="mAppearance" style="font-size:12px; color:#555; font-style:italic; margin:8px 0; padding:6px 8px; background:#f9f9f9; border-radius:4px;"></div>
                <div id="mTags" style="margin-top:6px;"></div>
            </div>

            <!-- ========= ä¸­é—´ï¼šå±æ€§ä¿¡æ¯åŒºåŸŸ ========= -->
            <!-- å°†åŸæ¥çš„å±æ€§æŒ‰ç±»å‹åˆ†å—ï¼šåŸºç¡€èº«ä»½ / æ•°å€¼å±æ€§ / æƒ…æ„ŸçŠ¶æ€ï¼Œæ–¹ä¾¿å¿«é€Ÿæ‰«ä¸€çœ¼ -->
            <div class="detail-center">
                <!-- èº«ä»½ä¿¡æ¯ï¼šå½“å‰çŠ¶æ€ã€æŒæœ‰ç‰©å“ç­‰ -->
                <div class="detail-attr-section">
                    <div class="detail-attr-title">ğŸ§¾ èº«ä»½ä¿¡æ¯</div>
                    <div class="detail-attr-row">
                        <span>å½“å‰çŠ¶æ€</span>
                        <strong id="mStatus">æ­£å¸¸</strong>
                    </div>
                    <div class="detail-attr-row">
                        <span>æŒæœ‰ç‰©å“</span>
                        <span id="mItems" style="font-size:12px; color:#666; text-align:right; max-width:220px;"></span>
                    </div>
                </div>

                <!-- æ•°å€¼å±æ€§ï¼šä¿®ä¸º / æ™ºåŠ› / é­…åŠ› -->
                <div class="detail-attr-section">
                    <div class="detail-attr-title">ğŸ“Š æ•°å€¼å±æ€§</div>
                    <div class="detail-attr-row">
                        <span>å¢ƒç•Œä¿®ä¸º</span>
                        <strong id="mPower"></strong>
                    </div>
                    <div class="detail-attr-row">
                        <span>æ™ºåŠ›è°‹ç•¥</span>
                        <strong id="mInt"></strong>
                    </div>
                    <div class="detail-attr-row">
                        <span>å®¹è²Œé­…åŠ›</span>
                        <strong id="mCharm"></strong>
                    </div>
                </div>

                <!-- æƒ…æ„ŸçŠ¶æ€ï¼šå¥½æ„Ÿ / çˆ±æ„ / é»‘åŒ–ï¼ˆNPC ä½¿ç”¨ï¼›ç©å®¶ä¼šéšè—è¿™ä¸€å—ï¼‰ -->
                <div class="detail-attr-section detail-attr-emotion">
                    <div class="detail-attr-title">ğŸ’– æƒ…æ„Ÿä¸å¿ƒæ€§</div>
                    <div class="detail-attr-row">
                        <span>å¯¹ä½ æ€åº¦</span>
                        <strong id="mRelation" style="color:#d35400;">0</strong>
                    </div>
                    <div class="detail-attr-row">
                        <span>çˆ±æ„ç¾ç»Š</span>
                        <strong id="mLove" style="color:#e91e63;">0</strong>
                    </div>
                    <div class="detail-attr-row">
                        <span>é»‘åŒ–ç¨‹åº¦</span>
                        <span id="mDarkness" style="color:#8e44ad; font-weight:bold;">0</span>
                    </div>
                </div>
                
                <!-- äº²ç¼˜å…³ç³»ï¼šçˆ¶æ¯ / é“ä¾£ / å­å—£ -->
                <div class="detail-attr-section">
                    <div class="detail-attr-title">ğŸ‘ª äº²ç¼˜å…³ç³»</div>
                    <div class="detail-attr-row">
                        <span>çˆ¶æ¯åŒäº²</span>
                        <span id="mParents" style="font-size:12px; text-align:right;"></span>
                    </div>
                    <div class="detail-attr-row">
                        <span>ç»“å‘é“ä¾£</span>
                        <span id="mSpouseView" style="font-size:12px; text-align:right;"></span>
                    </div>
                    <div class="detail-attr-row">
                        <span>è†ä¸‹å­å—£</span>
                        <span id="mChildren" style="font-size:12px; text-align:right; line-height:1.3;"></span>
                    </div>
                </div>
            </div>

            <!-- ========= å³ä¾§ï¼šäº¤äº’æŒ‰é’®æ  ========= -->
            <!-- å°†äº¤è°ˆ / èµ ç¤¼ / æ”»å‡»ç­‰æ“ä½œé›†ä¸­åœ¨ä¸€åˆ—ï¼Œè®©ç©å®¶ä¸€çœ¼å°±èƒ½çœ‹åˆ°å¯ä»¥åšä»€ä¹ˆ -->
            <div class="detail-right">
                <div class="detail-right-title">ğŸ¯ å¯ç”¨äº’åŠ¨</div>
                <div class="modal-actions" id="mActions"></div>
            </div>
        </div>
    </div>

    <div class="modal-overlay" id="inventoryModal" onclick="if(event.target===this) document.getElementById('inventoryModal').style.display='none'">
        <div class="modal">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px;">
                <h3 style="margin:0;">ğŸ“¦ å‚¨ç‰©è¢‹</h3>
                <span style="cursor:pointer;" onclick="document.getElementById('inventoryModal').style.display='none'">Ã—</span>
            </div>
            <div id="invList" style="max-height: 300px; overflow-y: auto;"></div>
        </div>
    </div>

    <div class="modal-overlay" id="settingsModal" onclick="if(event.target===this) window.closeModal()">
        <div class="modal" style="width:320px;"> <div style="display:flex; justify-content:space-between; margin-bottom:15px; border-bottom:1px solid #eee; padding-bottom:10px;">
            <h3 style="margin:0;">âš™ï¸ æ¸¸æˆè®¾ç½®</h3>
            <span style="cursor:pointer;" onclick="window.closeModal()">Ã—</span>
        </div>
        <div style="font-size:14px; line-height:2;">
            <div>
                <input type="checkbox" id="set_gossip" onclick="window.toggleSetting('showGossip')"> 
                <label for="set_gossip">æ˜¾ç¤ºè·¯äººå…«å¦/è¡¨ç™½</label>
            </div>
            <div>
                <input type="checkbox" id="set_battle" onclick="window.toggleSetting('showBattle')"> 
                <label for="set_battle">æ˜¾ç¤ºè·¯äººæˆ˜æ–—/ä»‡æ€</label>
            </div>
            <div>
                <input type="checkbox" id="set_birth" onclick="window.toggleSetting('showBirth')"> 
                <label for="set_birth">æ˜¾ç¤ºè·¯äººç”Ÿå­/ä¼ é—»</label>
            </div>
            
            <div style="margin: 10px 0; border-top: 1px dashed #eee;"></div>
            <div style="margin-bottom: 5px; font-weight:bold; color:var(--main-color);">ğŸµ éŸ³é¢‘æ§åˆ¶</div>

            <div style="background:#f9f9f9; padding:8px; border-radius:5px; margin-bottom:8px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <label style="display:flex; align-items:center;">
                        <input type="checkbox" id="set_bgm" onclick="window.toggleSetting('enableBGM')"> 
                        <span style="margin-left:5px; font-weight:bold; font-size:12px;">èƒŒæ™¯éŸ³ä¹</span>
                    </label>
                    <span id="display_bgm_vol" style="font-size:12px; color:#888;">40%</span>
                </div>
                <input type="range" id="vol_bgm" min="0" max="1" step="0.05" style="width:100%; cursor:pointer;" 
                    oninput="window.adjustVolume('bgm', this.value)">
            </div>

            <div style="background:#f9f9f9; padding:8px; border-radius:5px;">
                <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:5px;">
                    <label style="display:flex; align-items:center;">
                        <input type="checkbox" id="set_sfx" onclick="window.toggleSetting('enableSFX')"> 
                        <span style="margin-left:5px; font-weight:bold; font-size:12px;">æ¸¸æˆéŸ³æ•ˆ</span>
                    </label>
                    <span id="display_sfx_vol" style="font-size:12px; color:#888;">60%</span>
                </div>
                <input type="range" id="vol_sfx" min="0" max="1" step="0.05" style="width:100%; cursor:pointer;" 
                    oninput="window.adjustVolume('sfx', this.value)"
                    onchange="window.playSound('click')">
            </div>

            <div style="margin-top:10px; color:#999; font-size:12px;">
                * æ³¨ï¼šä¸ä½ /é“ä¾£/å­å¥³ç›¸å…³çš„äº‹ä»¶æ°¸è¿œæ˜¾ç¤ºã€‚
        </div>
    </div>
    </div>
    </div>
    <div class="modal-overlay" id="historyModal" style="z-index: 200;" onclick="if(event.target===this) document.getElementById('historyModal').style.display='none'">
        <div class="modal" style="width: 400px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                <h3 style="margin:0;">ğŸ“œ ç”Ÿå¹³å±¥å†</h3>
                <span style="cursor:pointer; font-size:20px;" onclick="document.getElementById('historyModal').style.display='none'">Ã—</span>
            </div>
            <div id="historyContent" style="max-height: 500px; overflow-y: auto; padding: 5px;"></div>
        </div>
    </div>
<div id="dao-modal" class="modal-overlay" style="display: none;">
    <div class="modal-content">
        <div class="modal-header">
            <h3>è®ºé“ Â· é‡å¡‘é“å¿ƒ</h3>
            <span class="close-btn" onclick="closeDaoModal()">Ã—</span>
        </div>
        <div class="modal-body">
            <p id="dao-target-name">æ­£åœ¨ä¸ æŸæŸ è®ºé“...</p>
            
            <div class="dao-grid">
                <button class="dao-btn light" onclick="confirmDao(1)">
                    <span class="btn-title">ç‚¹åŒ–</span>
                    <span class="btn-desc">æ˜æ‚Ÿå¤©é“ (é“å¾·â†‘)</span>
                </button>
                <button class="dao-btn dark" onclick="confirmDao(2)">
                    <span class="btn-title">è›Šæƒ‘</span>
                    <span class="btn-desc">å •å…¥é­”é“ (é“å¾·â†“)</span>
                </button>

                <button class="dao-btn light" onclick="confirmDao(3)">
                    <span class="btn-title">æ„ŸåŒ–</span>
                    <span class="btn-desc">é¢†æ‚Ÿç¾ç»Š (æƒ…ä¹‰â†‘)</span>
                </button>
                <button class="dao-btn dark" onclick="confirmDao(4)">
                    <span class="btn-title">ç¦»é—´</span>
                    <span class="btn-desc">çœ‹é€ç‚å‡‰ (æƒ…ä¹‰â†“)</span>
                </button>

                <button class="dao-btn light" onclick="confirmDao(5)">
                    <span class="btn-title">åˆ©è¯±</span>
                    <span class="btn-desc">é‡Šæ”¾è´ªæ¬² (æ¬²æœ›â†‘)</span>
                </button>
                <button class="dao-btn dark" onclick="confirmDao(6)">
                    <span class="btn-title">è‹¦è¡Œ</span>
                    <span class="btn-desc">æ¸…é™æ— ä¸º (æ¬²æœ›â†“)</span>
                </button>
            </div>
        </div>
    </div>
</div>
    <div class="modal-overlay" id="mapModal" style="z-index: 300;" onclick="if(event.target===this) document.getElementById('mapModal').style.display='none'">
        <div class="modal" style="width: 450px;">
            <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
                <h3 style="margin:0;">ğŸŒ ä¸–ç•Œåœ°å›¾</h3>
                <span style="cursor:pointer; font-size:20px;" onclick="document.getElementById('mapModal').style.display='none'">Ã—</span>
            </div>
            <div style="margin-bottom:15px; font-size:13px; color:#555; background:#f9f9f9; padding:8px; border-radius:4px;">
                å½“å‰æ‰€åœ¨åœ°ï¼š<span id="mapCurrentLoc" style="font-weight:bold; color:var(--main-color); font-size:15px;"></span>
                <div style="font-size:11px; color:#999; margin-top:4px;">(æç¤ºï¼šè·¯é€”é¥è¿œï¼Œèµ¶è·¯æœŸé—´å°†è‡ªåŠ¨è¿›è¡Œä¿®ç‚¼ï¼Œæ”¶ç›Šçº¦ä¸ºé—­å…³çš„ 50%~80%)</div>
            </div>
            <div id="mapList" style="display:flex; flex-direction:column; gap:10px; max-height:400px; overflow-y:auto;">
                </div>
        </div>
    </div>
<script type="module" src="main.js"></script>
<div id="alertModal" class="modal-overlay" style="z-index: 20000; display: none;">
    <div class="modal" style="width: 300px; text-align: center; animation: modalPop 0.3s cubic-bezier(0.175, 0.885, 0.32, 1.275);">
        <h3 id="alertTitle" style="margin-top:0; color:var(--main-color);">æç¤º</h3>
        <p id="alertMsg" style="color:#555; margin: 20px 0; line-height: 1.5;"></p>
        <button class="btn" style="background:var(--main-color); color:white; width:100%;" onclick="closeCustomAlert()">çŸ¥é“äº†</button>
    </div>
</div>

<div id="confirmModal" class="modal-overlay" style="z-index: 20000; display: none;">
    <div class="modal" style="width: 320px; text-align: center; animation: modalPop 0.3s;">
        <h3 id="confirmTitle" style="margin-top:0; color:#d35400;">è¯·ç¡®è®¤</h3>
        <p id="confirmMsg" style="color:#555; margin: 20px 0; text-align: left; background: #f9f9f9; padding: 10px; border-radius: 4px;"></p>
        <div style="display:flex; gap:10px;">
            <button class="btn" style="flex:1; background:#95a5a6; color:white;" onclick="resolveConfirm(false)">å–æ¶ˆ</button>
            <button class="btn" style="flex:1; background:#d35400; color:white;" onclick="resolveConfirm(true)">ç¡®å®š</button>
        </div>
    </div>
</div>

<div id="inputModal" class="modal-overlay" style="z-index: 20000; display: none;">
    <div class="modal" style="width: 320px; text-align: center; animation: modalPop 0.3s;">
        <h3 id="inputTitle" style="margin-top:0; color:#2980b9;">è¾“å…¥</h3>
        <p id="inputMsg" style="color:#666; font-size:12px; margin-bottom:10px;"></p>
        <input type="text" id="inputField" style="width:90%; padding:8px; border:1px solid #ddd; border-radius:4px; margin-bottom:20px; font-size:16px;">
        <div style="display:flex; gap:10px;">
            <button class="btn" style="flex:1; background:#95a5a6; color:white;" onclick="resolveInput(null)">å–æ¶ˆ</button>
            <button class="btn" style="flex:1; background:#2980b9; color:white;" onclick="resolveInput(document.getElementById('inputField').value)">ç¡®å®š</button>
        </div>
    </div>
</div>

<div id="choiceModal" class="modal-overlay" style="z-index: 20000; display: none;">
    <div class="modal" style="width: 350px; animation: modalPop 0.3s;">
        <h3 id="choiceTitle" style="margin-top:0; border-bottom:1px solid #eee; padding-bottom:10px;">è¯·é€‰æ‹©</h3>
        <div id="choiceList" style="display:flex; flex-direction:column; gap:8px; max-height:300px; overflow-y:auto; padding:5px;">
            </div>
        <button class="btn" style="margin-top:15px; width:100%; background:#95a5a6; color:white;" onclick="resolveChoice(null)">å…³é—­</button>
    </div>
</div>
<dialog id="game-modal">
    <h3 id="modal-title">æç¤º</h3>
    <div id="modal-content">å†…å®¹åŒºåŸŸ</div>
    <input type="text" id="modal-input" placeholder="è¯·è¾“å…¥...">
    <div class="modal-buttons">
        <button id="btn-cancel" class="modal-btn">å–æ¶ˆ</button>
        <button id="btn-confirm" class="modal-btn">ç¡®å®š</button>
    </div>
</dialog>
</body>
<div class="modal-overlay" id="familyTreeModal" onclick="if(event.target===this) document.getElementById('familyTreeModal').style.display='none'">
    <div class="modal" style="width: 90%; height: 90%; max-width: 1000px; display:flex; flex-direction:column;">
        <div style="display:flex; justify-content:space-between; margin-bottom:10px; border-bottom:1px solid #eee; padding-bottom:5px;">
            <h3 style="margin:0;">ğŸŒ³ å®¶æ—è°±ç³»</h3>
            <span style="cursor:pointer; font-size:20px;" onclick="document.getElementById('familyTreeModal').style.display='none'">Ã—</span>
        </div>
        <div style="flex:1; overflow: auto; background:#f9f9f9; border-radius:4px; padding:20px; text-align:center;" id="familyTreeContainer">
            </div>
        <div style="margin-top:10px; text-align:center; font-size:12px; color:#999;">
            æç¤ºï¼šç‚¹å‡»è§’è‰²å¯æŸ¥çœ‹è¯¦æƒ…ï¼Œç‚¹å‡»ç©ºç™½å¤„å…³é—­ã€‚
        </div>
    </div>
</div>
</html>